## 进程环境

程序是可运行的二进制代码文件，把这种文件加载到内存中运行就得到了一个进程。

每个进程在系统中都有唯一的一个 ID 标识，称为进程标识符 PID。

同一程序文件可以被加载多次成为不同的进程。

### 进程

* 程序的执行实例被称为进程，是一个动态的概念，它是程序执行的过程，包括创建、调度和消亡
* 进程具有独立的权限与职责，如果系统中某个进程崩溃，它不会影响其余的进程
* 每个进程运行在其各自的虚拟地址空间中，进程之间可以通过由内核控制的机制相互通信

内核中的进程结构体：task_struct

### 进程的状态

* 运行态
* 等待态
* 停止态
* 死亡态

### exit 与 _exit 函数区别？

exit 与 `_exit` 函数都是用来终止进程的。

* `_exit` 函数执行后立即返回给内核，而 exit 函数要先执行一些清除操作，然后将控制权交给内核
* exit 函数是在 `_exit` 函数之上的一个封装
* exit 函数在调用 exit 系统之前要检查文件的打开情况，把文件缓冲区的内容写回文件；而 `_exit` 函数直接将进程关闭，缓冲区的数据丢失

### atexit 函数

```c
#include <stdlib.h>

// 向内核登记终止处理程序
int atexit(void(*function)(void));
```
* 每个启动的进程都默认登记一个标准的终止函数
* 终止函数在进程终止时释放进程占用的一些资源
* 登记的多个终止函数执行顺序是以栈的方式执行的，即先登记的后执行

### C 程序启动过程和终止

启动例程：一段程序代码，放置在 /lib/libc.so.*** 中。编译器在编译时会将启动例程的代码编译进可执行文件中。

可执行程序将这段嵌入的启动例程代码指代为程序的起始地址，当内核执行 C 程序时(使用 exec 函数)，在调用 main 函数前先执行启动例程代码。

exit 首先调用各终止处理程序，然后按需要多次调用 fclose 关闭所有打开流。而调用 `_exit` 或 `_Exit` 则将直接进入内核，不会调用终止处理函数和关闭被打开的流。

### 进程资源限制

配置文件：`/etc/security/limits.conf`

Linux 进程资源的初始化由 0 号进程建立，并被后续进程继承。

## 参考

* [进程与线程的一个简单解释](http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)
* [进程环境](http://www.cnblogs.com/5iedu/p/6353729.html)
